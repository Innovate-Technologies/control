RewriteEngine on

# Force SSL
RewriteCond %{SERVER_PORT} 80
RewriteCond %{SERVER_NAME} ^control.shoutca.st$
RewriteRule ^(.*)$ https://control.shoutca.st/$1 [R=301,L]

# If the request is not for a valid directory...
RewriteCond %{REQUEST_FILENAME} !-d [NC]
# If the request is not for a valid file...
RewriteCond %{REQUEST_FILENAME} !-f [NC]
# ... then pass it to AngularJS.
RewriteRule ^(.*) /index.html [L]

# Don't allow directories to be listed
Options -Indexes

# Font types
AddType font/ttf .ttf
AddType font/eot .eot
AddType font/otf .otf
AddType font/woff .woff

# Compression
SetOutputFilter DEFLATE
AddOutputFilterByType DEFLATE text/html text/css text/plain text/xml application/x-javascript text/javascript application/javascript

# Cache production JS and CSS for 1 month
<FilesMatch "\.min\.(css|js)$">
Header set Cache-Control "max-age=2629743, public, must-revalidate"
</FilesMatch>

# CORS
<FilesMatch "\.(ttf|otf|eot|woff|css)$">
<IfModule mod_headers.c>
Header set Access-Control-Allow-Origin "*"
</IfModule>
</FilesMatch>

Header set X-Frame-Options "DENY"
Header set Content-Security-Policy "default-src *; script-src 'self' https://piwik.shoutca.st; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;"
Header set X-Content-Security-Policy "default-src *; script-src 'self' https://piwik.shoutca.st; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;"
